<?xml version="1.0" encoding="utf-8"?>
<s:NavigatorContent creationComplete="creationCompleteHandler(event)"
					xmlns:mx="http://www.adobe.com/2006/mxml"
					xmlns:s="library://ns.adobe.com/flex/spark">
	<mx:Metadata>
		[Event(name="close", type="flash.events.Event")]
	</mx:Metadata>

	<mx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;

			import org.commnoslibs.report.events.ImageEvent;
			import org.commnoslibs.report.models.ImageFile;

			//------------------------------------------------------------------------------
			//
			//   Attributos 
			//
			//------------------------------------------------------------------------------

			//--------------------------------------
			//   Property 
			//--------------------------------------

			[Bindable]
			[Inject(source="imageManager.lista",bind=true)]
			public var dataProvider:ArrayCollection;

			//------------------------------------------------------------------------------
			//
			//   Metodos 
			//
			//------------------------------------------------------------------------------

			//--------------------------------------
			//   Function 
			//--------------------------------------

			protected function btnDownload_clickHandler(event:MouseEvent):void
			{
				dispatchEvent(new ImageEvent(ImageEvent.DOWNLOAD,list.selectedItem as ImageFile));
			}

			protected function btnExcluir_clickHandler(event:MouseEvent):void
			{
				dispatchEvent(new ImageEvent(ImageEvent.REMOVE,list.selectedItem as ImageFile));
			}

			protected function btnUpload_clickHandler(event:MouseEvent):void
			{
				dispatchEvent(new ImageEvent(ImageEvent.UPLOAD));
			}

			protected function btnVoltar_clickHandler(event:MouseEvent):void
			{
				dispatchEvent(new Event(Event.CLOSE));
			}

			protected function creationCompleteHandler(event:FlexEvent):void
			{
				dispatchEvent(new ImageEvent(ImageEvent.FIND_ALL));
			}
		]]>
	</mx:Script>

	<mx:DropShadowFilter id="dropShadowFilter"
						 alpha=".7"
						 blurX="5"
						 blurY="5"
						 distance="2"
						 quality="3"/>

	<mx:FormHeading label="Gerenciamento de Imagens"/>

	<mx:TileList id="list" width="100%" height="100%"
				 dataProvider="{ dataProvider }"
				 doubleClickEnabled="true"
				 doubleClick="btnDownload_clickHandler(event)"
				 liveScrolling="true">
		<mx:itemRenderer>
			<mx:Component>
				<mx:Canvas width="150" height="150"
						   clipContent="true"
						   horizontalScrollPolicy="off"
						   verticalScrollPolicy="off">

					<mx:Script>
						<![CDATA[
							import org.commnoslibs.report.models.ImageFile;
						]]>
					</mx:Script>

					<mx:Canvas width="120" height="120" top="10"
							   backgroundAlpha="1"
							   backgroundColor="#FFFFFF"
							   horizontalCenter="0"
							   filters="{ [outerDocument.dropShadowFilter] }">
						<mx:Image width="100" height="100"
								  horizontalAlign="center"
								  horizontalCenter="0"
								  verticalAlign="middle"
								  verticalCenter="0"
								  source="{ ImageFile(data).bitmapData }"
								  cacheAsBitmap="true"
								  maintainAspectRatio="true"
								  scaleContent="true"
								  smoothBitmapContent="true"/>
						<mx:ProgressBar width="100"
										horizontalCenter="0"
										verticalCenter="0"
										label="Enviando %3%"
										labelPlacement="center"
										source="{ ImageFile(data).fileReference }"
										visible="{ !Boolean(ImageFile(data).bitmapData) }"/>
					</mx:Canvas>
					<mx:Label width="140" top="135"
							  color="#333333"
							  fontSize="12"
							  horizontalCenter="0"
							  textAlign="center"
							  text="{ ImageFile(data).name }"
							  truncateToFit="true"
							  visible="{ Boolean(ImageFile(data).bitmapData) }"/>
				</mx:Canvas>
			</mx:Component>
		</mx:itemRenderer>
	</mx:TileList>

	<s:HGroup>
		<s:Button id="btnVoltar"
				  styleName="Voltar"
				  toolTip="Voltar"
				  click="btnVoltar_clickHandler(event)"
				  buttonMode="true"/>
		<s:Button styleName="Divider"/>
		<s:Button id="btnUpload"
				  styleName="Upload"
				  toolTip="Upload"
				  click="btnUpload_clickHandler(event)"
				  buttonMode="true"/>
		<s:Button id="btnDownload"
				  enabled="{ Boolean(ImageFile(list.selectedItem).bitmapData) }"
				  styleName="Download"
				  toolTip="Download"
				  click="btnDownload_clickHandler(event)"
				  buttonMode="true"/>
		<s:Button id="btnExcluir"
				  enabled="{ Boolean(ImageFile(list.selectedItem).bitmapData) }"
				  styleName="Excluir"
				  toolTip="Excluir"
				  click="btnExcluir_clickHandler(event)"
				  buttonMode="true"/>
	</s:HGroup>
</s:NavigatorContent>
